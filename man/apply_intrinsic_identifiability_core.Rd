% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/core_voxelwise_fit.R
\name{apply_intrinsic_identifiability_core}
\alias{apply_intrinsic_identifiability_core}
\title{Apply Intrinsic Identifiability (Core)}
\usage{
apply_intrinsic_identifiability_core(
  Xi_raw_matrix,
  Beta_raw_matrix,
  B_reconstructor_matrix,
  h_ref_shape_vector,
  ident_scale_method = "l2_norm",
  ident_sign_method = "canonical_correlation"
)
}
\arguments{
\item{Xi_raw_matrix}{The m x V raw manifold coordinates from extract_xi_beta_raw_svd_core}

\item{Beta_raw_matrix}{The k x V raw condition amplitudes from extract_xi_beta_raw_svd_core}

\item{B_reconstructor_matrix}{The p x m HRF reconstructor matrix}

\item{h_ref_shape_vector}{The p x 1 reference HRF shape (e.g., canonical HRF)}

\item{ident_scale_method}{Scaling method: "l2_norm" (unit length), "max_abs_val"
(peak = 1), or "none"}

\item{ident_sign_method}{Sign alignment method: "canonical_correlation" (align with
reference) or "data_fit_correlation" (requires additional data, not implemented)}
}
\value{
A list containing:
\itemize{
\item \code{Xi_ident_matrix}: m x V matrix of identifiability-constrained manifold coordinates
\item \code{Beta_ident_matrix}: k x V matrix of identifiability-constrained condition amplitudes
}
}
\description{
Applies sign and scale constraints to ensure identifiability of HRF estimates.
}
\details{
This function implements Component 1, Step 5 of the M-HRF-LSS pipeline.
It ensures that HRF estimates are identifiable by:
\enumerate{
\item Aligning sign with a reference HRF (avoiding arbitrary sign flips)
\item Normalizing scale consistently across voxels
The beta amplitudes are adjusted inversely to preserve the overall signal.
}
}
\examples{
\dontrun{
# After SVD extraction
m <- 5
k <- 3
V <- 100
p <- 30

# Get raw Xi and Beta from SVD
svd_result <- extract_xi_beta_raw_svd_core(gamma, m, k)

# Apply identifiability with canonical HRF reference
h_canonical <- c(0, 0.8, 1, 0.7, 0.3, rep(0, p-5))  # simplified canonical
ident_result <- apply_intrinsic_identifiability_core(
  svd_result$Xi_raw_matrix,
  svd_result$Beta_raw_matrix,
  B_reconstructor,
  h_canonical
)
}

}

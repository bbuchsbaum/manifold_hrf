% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mhrf_lss_interface.R
\name{mhrf_lss}
\alias{mhrf_lss}
\title{Fit M-HRF-LSS Model}
\usage{
mhrf_lss(
  formula,
  dataset,
  baseline_model = NULL,
  hrf_library = "canonical",
  manifold_params = "balanced",
  estimation = c("condition", "trial", "both"),
  spatial_info = NULL,
  strategy = c("global", "runwise", "chunked"),
  nchunks = 10,
  robust = FALSE,
  progress = TRUE,
  verbose = TRUE,
  ...
)
}
\arguments{
\item{formula}{Formula specification for event model (same as fmrireg)}

\item{dataset}{An fmri_dataset object from fmrireg}

\item{baseline_model}{Optional baseline model from fmrireg::baseline_model()}

\item{hrf_library}{Source for HRF library. Can be:
\itemize{
\item Character: "canonical" (uses fmrireg HRFs), "flobs", "gamma_grid"
\item List of fmrireg HRF objects (e.g., list(HRF_SPMG1, HRF_GAMMA))
\item Matrix of HRF shapes (p x N)
\item Path to saved HRF library
}}

\item{manifold_params}{List of manifold construction parameters or preset name}

\item{estimation}{What to estimate: "condition", "trial", or "both"}

\item{spatial_info}{Optional NeuroSpace or voxel coordinates for spatial smoothing}

\item{strategy}{Processing strategy: "global", "runwise", "chunked"}

\item{nchunks}{Number of chunks for memory efficiency}

\item{robust}{Use robust estimation (downweight outliers)}

\item{progress}{Show progress bar}

\item{verbose}{Print detailed messages}

\item{...}{Additional arguments}
}
\value{
An mhrf_lss_fit object containing:
\itemize{
\item manifold: The HRF manifold object
\item hrfs: Estimated voxel-specific HRFs
\item betas_condition: Condition-level amplitudes
\item betas_trial: Trial-wise amplitudes (if requested)
\item model_info: Original model specifications
\item diagnostics: Fit quality metrics
}
}
\description{
Main interface for manifold-guided HRF estimation and trial-wise deconvolution.
Follows fmrireg patterns but extends with manifold-based HRF estimation.
}
\examples{
\dontrun{
# Load fmrireg for dataset creation
library(fmrireg)

# Create dataset (using fmrireg)
dset <- fmri_dataset(
  scans = "bold.nii.gz",
  mask = "mask.nii.gz", 
  TR = 2,
  run_length = c(200, 200)
)

# Basic M-HRF-LSS fit
fit <- mhrf_lss(
  ~ hrf(condition),
  dataset = dset,
  hrf_library = "canonical",
  estimation = "both"
)

# Advanced with custom parameters
fit_custom <- mhrf_lss(
  ~ hrf(cond1) + hrf(cond2),
  dataset = dset,
  baseline_model = baseline_model(degree = 2),
  hrf_library = list(HRF_SPMG1, HRF_SPMG2, HRF_SPMG3, HRF_GAMMA),
  manifold_params = "balanced",  # or custom list
  spatial_info = dset$mask,
  robust = TRUE
)
}

}

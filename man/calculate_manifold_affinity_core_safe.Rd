% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/core_manifold_construction.R
\name{calculate_manifold_affinity_core_safe}
\alias{calculate_manifold_affinity_core_safe}
\title{Calculate Manifold Affinity Safely}
\usage{
calculate_manifold_affinity_core_safe(
  L_library_matrix,
  k_local_nn_for_sigma,
  use_sparse_W_params = list(),
  distance_engine = c("euclidean", "ann_euclidean"),
  ann_threshold = 10000
)
}
\arguments{
\item{L_library_matrix}{A p x N matrix of HRF shapes, where p is the number
of time points and N is the number of HRFs in the library}

\item{k_local_nn_for_sigma}{Positive integer (< N), k-nearest neighbors for
self-tuning bandwidth calculation (e.g., 7)}

\item{use_sparse_W_params}{List with optional parameters for sparse W matrix:
\itemize{
\item \code{sparse_if_N_gt}: Threshold for N to switch to sparse matrix (e.g., 5000)
\item \code{k_nn_for_W_sparse}: Number of nearest neighbors to keep in sparse W. Must be less
than the number of HRFs (N); values \code{>= N} are truncated to \code{N - 1}.
}}

\item{distance_engine}{Character string specifying the distance computation
method. Options are \code{"euclidean"} for exact distances or
\code{"ann_euclidean"} for approximate nearest neighbors via RcppHNSW.
If \code{"ann_euclidean"} is requested but the RcppHNSW package is not
installed, the function falls back to exact distances with a warning.}

\item{ann_threshold}{Integer. When \code{distance_engine = "euclidean"} and
the number of HRFs exceeds this threshold, the function will attempt to use
RcppHNSW for approximate neighbors if available.}
}
\value{
Markov transition matrix
}
\description{
Wrapper around \code{calculate_manifold_affinity_core} that catches
errors and falls back to a simple Euclidean distance affinity matrix.
}

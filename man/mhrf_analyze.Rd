% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mhrf_lss.R
\name{mhrf_analyze}
\alias{mhrf_analyze}
\title{Analyze fMRI Data with M-HRF-LSS}
\usage{
mhrf_analyze(
  Y_data,
  events,
  TR = 2,
  preset = "balanced",
  hrf_library = "auto",
  voxel_mask = NULL,
  n_jobs = 1,
  verbose = TRUE,
  save_intermediate = FALSE,
  output_dir = tempdir(),
  logger = NULL,
  ...
)
}
\arguments{
\item{Y_data}{An n x V numeric matrix of fMRI time series (n timepoints, V voxels),
or a NeuroVec object from the neuroim2 package}

\item{events}{A data frame with columns:
\itemize{
\item \code{onset}: Event onset times in seconds
\item \code{duration}: Event duration in seconds (default: 0)
\item \code{condition}: Factor or character vector of condition labels
\item \code{trial_type}: Optional trial identifiers for trial-wise estimation
}}

\item{TR}{Repetition time in seconds (default: 2)}

\item{preset}{Character string specifying parameter preset: "conservative",
"balanced" (default), "aggressive", "fast", "quality", or "robust"}

\item{hrf_library}{Source for HRF library. Options:
\itemize{
\item \code{"auto"}: Automatically generate appropriate library (default)
\item \code{"spmg1"}: SPM canonical HRF variants
\item \code{"gamma"}: Gamma function variants
\item \code{"custom"}: User-provided p x N matrix
}}

\item{voxel_mask}{Optional logical vector or 3D array indicating which voxels
to analyze. If NULL, all non-zero variance voxels are analyzed.}

\item{n_jobs}{Number of parallel jobs for voxel processing (default: 1).
Set to -1 to use all available cores.}

\item{verbose}{Logical (default: TRUE) or integer (0-3) controlling output:
\itemize{
\item \code{0}: Silent
\item \code{1}/\code{TRUE}: Progress milestones
\item \code{2}: Detailed progress
\item \code{3}: Debug output
}}

\item{save_intermediate}{Logical; whether to save intermediate results for
debugging (default: FALSE)}

\item{output_dir}{Directory for saving results and intermediate files
(default: temporary directory). If the directory does not exist, it will be
created automatically.}

\item{...}{Additional parameters to override preset values. See
\code{\link{get_preset_params}} for available options.}
}
\value{
An object of class "mhrf_result" containing:
\itemize{
\item \code{hrf_shapes}: p x V matrix of estimated HRF shapes
\item \code{amplitudes}: k x V matrix of condition-level amplitudes
\item \code{trial_amplitudes}: List of trial-wise amplitude estimates
\item \code{manifold_coords}: m x V matrix of manifold coordinates
\item \code{qc_metrics}: Quality control metrics and diagnostics
\item \code{metadata}: Processing details and parameters used
\item \code{call}: The original function call
}
}
\description{
Main unified function for running the complete M-HRF-LSS pipeline. This function
provides a simple interface to estimate voxel-specific HRFs and trial-wise
amplitudes from fMRI data.
}
\examples{
\dontrun{
# Basic usage with data frame events
result <- mhrf_analyze(
  Y_data = fmri_matrix,
  events = event_df,
  TR = 2
)

# Use robust preset for noisy data
result <- mhrf_analyze(
  Y_data = fmri_matrix,
  events = event_df,
  TR = 2,
  preset = "robust"
)

# Parallel processing with custom parameters
result <- mhrf_analyze(
  Y_data = fmri_matrix,
  events = event_df,
  TR = 2,
  n_jobs = 4,
  lambda_gamma = 0.05,
  m_manifold_dim_target = 6
)

# With brain mask
result <- mhrf_analyze(
  Y_data = fmri_matrix,
  events = event_df,
  TR = 2,
  voxel_mask = brain_mask
)
}

}
\seealso{
\code{\link{get_preset_params}} for parameter presets,
\code{\link{summary.mhrf_result}} for result summary,
\code{\link{plot.mhrf_result}} for diagnostic plots
}
